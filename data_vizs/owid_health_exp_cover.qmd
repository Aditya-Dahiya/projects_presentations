---
title: "....New Exploratory Project.........."
author: "Aditya Dahiya"
date: "2024-06-03"
subtitle: ".........."
categories:
  - "A4 Size Viz"
  - "Our World in Data"
  - "Public Health"
image: "thumbnails/..........png"
format:
  html:
    code-fold: true
editor_options: 
  chunk_output_type: console
execute: 
  error: false
  message: false
  warning: false
  eval: false
filters:
  - social-share
share:
  permalink: "https://aditya-dahiya.github.io/session_presentations/data_vizs.html"
  twitter: true
  linkedin: true
  email: true
  mastodon: true
bibliography: references.bib
---

### ...........................

### How I made this graphic?

Getting the data

```{r}
#| label: setup

# Data Import and Wrangling Tools
library(tidyverse)            # All things tidy
library(owidR)                # Get data from Our World in R

# Final plot tools
library(scales)               # Nice Scales for ggplot2
library(fontawesome)          # Icons display in ggplot2
library(ggtext)               # Markdown text support for ggplot2
library(showtext)             # Display fonts in ggplot2
library(colorspace)           # To lighten and darken colours

# The Expansion pack to ggplot2
library(ggforce)              # To learn some new geom-extensions
library(wbstats)              # To fetch World Bank data on Country
                              # Codes and GDP per capita
# Credits: https://stackoverflow.com/questions/48199791/rounded-corners-in-ggplot2
# Credits @X: @TeunvandenBrand
# devtools::install_github("teunbrand/elementalist")
library(elementalist)         # Rounded corners of panels


# Data from 1990 to 2021
# Coverage of essential health services, as defined by the 
# UHC service coverage index - Both Sexes - Estimate
rawdf1 <- owidR::owid("healthcare-access-quality-ihme")

# Our World in Data
# Current health expenditure per capita, PPP (current international $)
# GDP per capita Population (historical estimates) Countries Continents
rawdf2 <- owidR::owid("healthcare-expenditure-vs-gdp")

```

Visualization Parameters

```{r}
#| label: parameters2

# Font for titles
font_add_google("Glegoo",
  family = "title_font"
) 

# Font for the caption
font_add_google("Stint Ultra Condensed",
  family = "caption_font"
) 

# Font for plot text
font_add_google("Maiden Orange",
  family = "body_font"
) 

showtext_auto()

# Colour Palette
mypal <- paletteer::paletteer_d("PNWColors::Mushroom")
mypal

# Background Colour
bg_col <- mypal[6]
text_col <- mypal[1]
text_hil <- mypal[2]

# Base Text Size
bts <- 80

plot_title <- ""
str_view(plot_title)

plot_subtitle <- ""

# Caption stuff for the plot
sysfonts::font_add(
  family = "Font Awesome 6 Brands",
  regular = here::here("docs", "Font Awesome 6 Brands-Regular-400.otf")
)
github <- "&#xf09b"
github_username <- "aditya-dahiya"
xtwitter <- "&#xe61b"
xtwitter_username <- "@adityadahiyaias"
social_caption_1 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{github};</span> <span style='color: {text_hil}'>{github_username}  </span>")
social_caption_2 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{xtwitter};</span> <span style='color: {text_hil}'>{xtwitter_username}</span>")


plot_caption <- paste0(
  "**Data:** Our World in Data |  ",
  "**Code:** ", 
  social_caption_1, 
  " |  **Graphics:** ", 
  social_caption_2
  )

```

Exploratory Data Analysis and Data Wrangling

```{r}
#| label: data-wrangling

# temp1 <- owidR::owid_search("Healthcare")
# temp2 <- owidR::owid_search("health")

# Universal Health Coverage Service Index
df1 <- rawdf1 |> 
  as_tibble() |>
  rename(coverage = `Coverage of essential health services, as defined by the UHC service coverage index - Both Sexes - Estimate`) |> 
  rename(
    country = entity
  )


# Current Health Expenditure (Per Person) and GDP Per Capita
df2 <- rawdf2 |> 
  as_tibble() |> 
  janitor::clean_names() |> 
  select(-countries_continents, -population_historical_estimates) |> 
  drop_na() |> 
  rename(
    country = entity,
    health_exp = current_health_expenditure_per_capita_ppp_current_international
  )

plotdf <- df1 |> 
  left_join(df2) |> 
  drop_na()

plotdf |> 
  count(year, sort = T) |> 
  ggplot(
    aes(y = n, x = year)
  ) +
  geom_point() +
  scale_x_continuous(breaks = 2000:2021)

plotdf |> 
  pull(year) |> 
  range()

g <- plotdf1 |>
  ggplot(
    mapping = aes(
      x = fitted,
      y = coverage
    )
  ) + 
  geom_point(
    alpha = 0.4
  ) +
  geom_abline(
    colour = "red",
    slope = 80/0.1
  ) +
  scale_x_continuous(
    limits = c(0, 0.15),
    oob = scales::squish
  ) +
  scale_y_continuous(
    limits = c(20, 80)
  ) +
  labs(
    title = "Year: {frame_time}"
  )
```

Visualization

```{r}
#| label: visualize

g_base
```

Add annotations and insets

```{r}
#| label: insets

# QR Code for the plot
url_graphics <- paste0(
  "https://aditya-dahiya.github.io/projects_presentations/projects/",
  # The file name of the current .qmd file
  "owid_le_improv_compare",
  ".qmd"
)
# remotes::install_github('coolbutuseless/ggqr')
# library(ggqr)
plot_qr <- ggplot(
  data = NULL, 
  aes(x = 0, y = 0, label = url_graphics)
  ) + 
  ggqr::geom_qr(
    colour = text_hil, 
    fill = bg_col,
    size = 1.5
    ) +
  # labs(caption = "Scan for the Interactive Version") +
  coord_fixed() +
  theme_void() +
  theme(plot.background = element_rect(
    fill = NA, 
    colour = NA
    ),
    plot.caption = element_text(
      hjust = 0.5,
      margin = margin(0,0,0,0, "mm"),
      family = "caption_font",
      size = bts/1.8
    )
  )

library(patchwork)
g <- g_base +
  inset_element(
    p = plot_qr,
    left = 0.98, right = 1.3,
    top = 0.2, bottom = 0,
    align_to = "panel"
  ) +
  plot_annotation(
    theme = theme(
      plot.background = element_rect(
        fill = "transparent",
        colour = "transparent"
      ),
      panel.background = element_rect(
        fill = "transparent",
        colour = "transparent"
      )
    )
  )
```

Save graphic and a thumbnail

```{r}
#| label: save-plot
ggsave(
  filename = here::here("data_vizs", ".........png"),
  plot = g,
  height = 297 * 2,
  width = 210 * 2,
  units = "mm",
  bg = bg_col
)

library(magick)
# Saving a thumbnail for the webpage
image_read(here::here("data_vizs", 
                      "............png")) |> 
  image_resize(geometry = "400") |> 
  image_write(here::here("data_vizs", "thumbnails", 
                         "............png"))
```
