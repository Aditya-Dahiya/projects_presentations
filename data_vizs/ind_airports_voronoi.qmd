---
title: "Airports of India"
author: "Aditya Dahiya"
date: "2024-05-26"
subtitle: "Voronoi Tesselation to produce nearest airports to each region in India"
categories:
  - "A4 Size Viz"
  - "Our World in Data"
image: "thumbnails/ind_airports_voronoi.png"
format:
  html:
    code-fold: true
editor_options: 
  chunk_output_type: console
execute: 
  error: false
  message: false
  warning: false
  eval: false
filters:
  - social-share
share:
  permalink: "https://aditya-dahiya.github.io/session_presentations/data_vizs.html"
  twitter: true
  linkedin: true
  email: true
  mastodon: true
bibliography: references.bib
---

## 

### *An interactive version of the same plot (work in-progress)*

```{r}
#| label: fig-interact-airports
#| eval: false
#| fig-cap: ""
#| echo: false

```

### How I made this graphic?

Getting the data

```{r}
#| label: setup

# Data Import and Wrangling Tools
library(tidyverse)            # All things tidy

# Final plot tools
library(scales)               # Nice Scales for ggplot2
library(fontawesome)          # Icons display in ggplot2
library(ggtext)               # Markdown text support for ggplot2
library(showtext)             # Display fonts in ggplot2
# library(colorspace)         # To lighten and darken colours

# Maps related packages
library(sf)                   # Geomteric objects manipulation and plotting

# Get State Map of India
india_map <- read_sf(here::here(
  "data", "india_map", "India_State_Boundary.shp"
)) |> 
  st_simplify(dTolerance = 1000) |> 
  st_transform(crs = 4326)

# Get locations of Airports in India
ind_airports <- airportr::airports |> 
  janitor::clean_names() |> 
  rename(lat = latitude, lon = longitude, airport = name) |> 
  filter(country == "India") |> 
  st_as_sf(coords = c("lon", "lat"), crs = 4326)

# Air Force run airports
ind_airports |> 
  filter(str_detect(airport, "Air Force"))

# Check the data: it works!
ggplot() +
  geom_sf(data = india_map) +
  geom_sf(data = ind_airports)
```

Visualization Parameters

```{r}
#| label: parameters2

# Font for titles
font_add_google("Dosis",
  family = "title_font"
) 

# Font for the caption
font_add_google("Saira Extra Condensed",
  family = "caption_font"
) 

# Font for plot text
font_add_google("Saira Semi Condensed",
  family = "body_font"
) 

showtext_auto()

# Background Colour
bg_col <- "white"
text_col <- "grey20"
text_hil <- "grey30"

# Base Text Size
bts <- 80

plot_title <- ""

plot_subtitle <- str_wrap("", 130)
str_view(plot_subtitle)

# Caption stuff for the plot
sysfonts::font_add(
  family = "Font Awesome 6 Brands",
  regular = here::here("docs", "Font Awesome 6 Brands-Regular-400.otf")
)
social_caption_1 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>&#xf09b;</span> <span style='color: {text_col}'>aditya-dahiya  </span>")
social_caption_2 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>&#xe61b;</span> <span style='color: {text_col}'>@adityadahiyaias </span>")
plot_caption <- paste0(
  "**Data:** ",
  "**Code:** ", social_caption_1, 
  " |  **Graphics:** ", social_caption_2
  )

```

Data Wrangling

```{r}
#| label: data-wrangling



# Credits: https://rpubs.com/valentin/pacific-centered-map-voronoi-tessellation
# by: Valentin Stefan
voronoi_lines <- ind_airports |> 
  st_union() |> 
  st_voronoi(bOnlyEdges = TRUE) |> 
  st_crop(st_bbox(india_map)) |> 
  st_intersection(india_map)

# Next Try
# Credits: https://stackoverflow.com/questions/76856625/perimeter-of-voronoi-cells

voronoi_lines <- ind_airports |> 
  st_union() |> 
  st_voronoi() |>
  st_collection_extract("POLYGON") |> 
  st_sf(geometry = _) |> 
  st_crop(st_bbox(india_map)) |> 
  st_intersection(india_map) 
  
voronoi_lines <- voronoi_lines |> 
  mutate(fill_var = sample(
  x = c("a", "b", "c", "d"),
  size = nrow(voronoi_lines),
  replace = T
  )
)
```

Visualization

```{r}
#| label: visualize


ggplot() +
  geom_sf(
    data = india_map
  ) +
  geom_sf(
    data = ind_airports
  ) +
  geom_sf(data = voronoi_lines,
          mapping = aes(fill = fill_var),
          alpha = 0.5) +
  theme(legend.position = "none") 
```

Add annotations and insets

```{r}
#| label: insets

# QR Code for the plot
url_graphics <- paste0(
  "https://aditya-dahiya.github.io/projects_presentations/projects/",
  # The file name of the current .qmd file
  "ind_airports_voronoi",
  ".qmd"
)
# remotes::install_github('coolbutuseless/ggqr')
# library(ggqr)
plot_qr <- ggplot(
  data = NULL, 
  aes(x = 0, y = 0, label = url_graphics)
  ) + 
  ggqr::geom_qr(
    colour = text_hil, 
    fill = bg_col,
    size = 2
    ) +
  # labs(caption = "Scan for the Interactive Version") +
  coord_fixed() +
  theme_void() +
  theme(plot.background = element_rect(
    fill = NA, 
    colour = NA
    ),
    plot.caption = element_text(
      hjust = 0.5,
      margin = margin(0,0,0,0, "mm"),
      family = "caption_font",
      size = bts/1.8
    )
  )
plot_qr

library(patchwork)
g <- g_base +
  inset_element(
    p = plot_qr,
    left = 0.85, right = 0.98,
    top = 0.88, bottom = 0.75,
    align_to = "full"
  ) +
  plot_annotation(
    theme = theme(
      plot.background = element_rect(
        fill = "transparent",
        colour = "transparent"
      ),
      panel.background = element_rect(
        fill = "transparent",
        colour = "transparent"
      )
    )
  )

```

Save graphic and a thumbnail

```{r}
#| label: save-plot

ggsave(
  filename = here::here("data_vizs", "a4_ind_airports_voronoi.png"),
  plot = g,
  height = 210 * 2,
  width = 297 * 2,
  units = "mm",
  bg = bg_col
)


library(magick)
# Saving a thumbnail for the webpage
image_read(here::here("data_vizs", 
                      "a4_ind_airports_voronoi.png")) |> 
  image_resize(geometry = "400") |> 
  image_write(here::here("data_vizs", "thumbnails", 
                         "ind_airports_voronoi.png"))

```
