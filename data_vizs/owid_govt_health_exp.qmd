---
title: "Government Health-Care Expenditure and Taxation"
author: "Aditya Dahiya"
date: "2024-08-08"
subtitle: "............"
categories:
  - "Our World in Data"
  - "Public Health"
image: "thumbnails/owid_govt_health_exp.png"
format:
  html:
    code-fold: true
editor_options: 
  chunk_output_type: console
execute: 
  error: false
  message: false
  warning: false
  eval: false
filters:
  - social-share
share:
  permalink: "https://aditya-dahiya.github.io/session_presentations/data_vizs.html"
  twitter: true
  linkedin: true
  email: true
  mastodon: true
bibliography: references.bib
---

## Government Health Care Expenditure

..................................................

![.........................](owid_govt_health_exp.png)

### How I made this graphic?

Getting the data

```{r}
#| label: setup

# Data Import and Wrangling Tools
library(tidyverse)            # All things tidy
library(owidR)                # Get data from Our World in R

# Final plot tools
library(scales)               # Nice Scales for ggplot2
library(fontawesome)          # Icons display in ggplot2
library(ggtext)               # Markdown text support
library(showtext)             # Display fonts in ggplot2
library(colorspace)           # To lighten and darken colours
library(patchwork)            # Combining plots

# Getting the data
search1 <- owidR::owid_search("health spending")

rawdf <- owid(search1[2,1])
```

Data Wrangling

```{r}
#| label: data-wrangling

object.size(rawdf)
names(rawdf)[4:5]

df <- rawdf |> 
  janitor::clean_names() |> 
  as_tibble() |> 
  rename(
    ghe = domestic_general_government_health_expenditure_per_capita_ppp_current_international,
    trpc = tax_revenues_per_capita_current_international,
    pop = population_historical
  ) |> 
  select(-countries_continents) |> 
  filter(!is.na(ghe)) |> 
  filter(!is.na(trpc))

df |> 
  # filter(year == 2020) |>
  filter(entity %in% sel_cons) |> 
  ggplot(
    mapping = aes(
      x = ghe,
      y = trpc
    ) 
  ) +
  geom_point(
    mapping = aes(
      colour = entity,
      size = pop
    ),
    alpha = 0.7
  ) +
  scale_size(range = c(1, 10)) +
  # geom_text(
  #   mapping = aes(
  #     label = entity
  #   ),
  #   check_overlap = T
  # ) +
  # scale_x_log10() +
  # scale_y_log10() +
  labs(
    x = names(rawdf)[4],
    y = names(rawdf)[5]
  ) +
  theme(legend.position = "none")

sel_cons <- df |> 
  filter(year == 2018) |> 
  filter(!is.na(code)) |>
  filter(entity != "World") |> 
  slice_max(order_by = pop, n = 10) |> 
  pull(entity)

df |> 
  filter(year < 2021) |> 
  filter(entity %in% sel_cons) |> 
  ggplot(
    mapping = aes(
      x = year,
      y = ghe / trpc,
      colour = entity
    )
  ) +
  geom_line() +
  geom_text(
    data = df |> filter(year == 2020 & entity %in% sel_cons),
    mapping = aes(
      x = 2020.2,
      y = ghe / trpc,
      colour = entity,
      label = entity
    ),
    check_overlap = T
  ) +
  scale_y_continuous(limits = c(0,0.5)) +
  theme(legend.position = "none")


df |> 
  ggplot(
    mapping = aes(
      x = ghe/trpc,
      y = as_factor(year)
    )
  ) +
  geom_violin() +
  # ggridges::geom_density_ridges(
  #   alpha = 0.2
  # ) +
  geom_boxplot(
    width = 0.4
  ) +
  scale_x_continuous(limits = c(0,0.5)) +
  theme_minimal()

df |> 
  filter(entity %in% sel_cons) |> 
  ggplot(aes(year, ghe, colour = entity)) +
  geom_point() +
  geom_line()


```

Visualization Parameters

```{r}
#| label: parameters2

# Font for titles
font_add_google("Acme",
  family = "title_font"
) 

# Font for the caption
font_add_google("Saira Extra Condensed",
  family = "caption_font"
) 

# Font for plot text
font_add_google("Changa",
  family = "body_font"
) 

showtext_auto()

# Colour Palette

# Background Colour
bg_col <- "white"
text_col <- "#2e5075"
text_hil <- "#18304a"

# Base Text Size
bts <- 80

plot_title <- "Global Migration Trends in 2020"

plot_subtitle <- str_wrap(
  glue::glue("There is dominance of internal migration within Asia and Europe. Major inter-continental migration routes include Asia to Europe, Asia to North America, and Latin America to North America."
      ),
  100
  )
str_view(plot_subtitle)

data_annotation <- "About the Data: The data comes from the United Nations (UN) and the United Nations Department of Economic and Social Affairs (UN DESA) for the year 2020."

# Caption stuff for the plot
sysfonts::font_add(
  family = "Font Awesome 6 Brands",
  regular = here::here("docs", "Font Awesome 6 Brands-Regular-400.otf")
)
github <- "&#xf09b"
github_username <- "aditya-dahiya"
xtwitter <- "&#xe61b"
xtwitter_username <- "@adityadahiyaias"
social_caption_1 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{github};</span> <span style='color: {text_hil}'>{github_username}  </span>")
social_caption_2 <- glue::glue("<span style='font-family:\"Font Awesome 6 Brands\";'>{xtwitter};</span> <span style='color: {text_hil}'>{xtwitter_username}</span>")

plot_caption <- paste0(
  "**Data:** United Nations & Our World in Data  |  ",
  "**Code:** ", 
  social_caption_1, 
  " |  **Graphics:** ", 
  social_caption_2
  )
rm(github, github_username, xtwitter, 
   xtwitter_username, social_caption_1, social_caption_2)
```

Visualization

```{r}
#| label: visualize

```

Save the graphic and a thumbnail

```{r}
#| label: save-plot

ggsave(
  filename = here::here("data_vizs", "owid_govt_health_exp.png"),
  plot = g,
  width = 500,
  height = 500,
  units = "mm",
  bg = bg_col
)


library(magick)
# Saving a thumbnail for the webpage
image_read(here::here("data_vizs", 
                      "owid_govt_health_exp.png")) |> 
  image_resize(geometry = "400") |> 
  image_write(here::here("data_vizs", "thumbnails", 
                         "owid_govt_health_exp.png"))
```
