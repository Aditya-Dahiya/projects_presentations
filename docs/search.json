[
  {
    "objectID": "data_vizs/owid_fertility.html",
    "href": "data_vizs/owid_fertility.html",
    "title": "Global Fertility Decline: A 70-Year Trend",
    "section": "",
    "text": "Source of the Data: The fertility rate data is sourced from the United Nations’ World Population Prospects (2022) and has been processed and presented by Our World in Data. The dataset provides the average number of live births a hypothetical cohort of women would have at the end of their reproductive period, assuming they experienced the fertility rates of a specific period throughout their lives without mortality impact. The data covers the period from 1950 to 2021 and is measured in live births per woman. Age-specific fertility rates are included, indicating the number of births to women in particular age groups, divided by the number of women in those groups, across annual civil calendar years. This dataset, part of the 27th edition of the official global population estimates, is based on extensive data on population size, fertility, mortality, and international migration for 237 countries or areas. For more information, visit the UN’s World Population Prospects page here and here. The data was retrieved on September 9, 2022. Our World in Data processes the data through various steps to ensure accuracy, including standardizing country names, converting units, and calculating derived indicators. Detailed information on their data processing can be found here. For citation purposes, use: UN, World Population Prospects (2022) – processed by Our World in Data.\n\n\n\n\n\n\nFigure 1: This graphic shows the changes in global fertility rates from the 1950s to the 2010s. The X-axis represents the proportion of the world population (0% to 100%), while the Y-axis shows the fertility rate levels (number of births per woman). The lines, colored by decade, illustrate the shift from highest to lowest fertility rate countries over time.\n\n\n\n\nHow I made these graphics?\nGetting the data\n\n\nCode\n# Data Import and Wrangling Tools\nlibrary(tidyverse)            # All things tidy\nlibrary(owidR)                # Get data from Our World in R\n\n# Final plot tools\nlibrary(scales)               # Nice Scales for ggplot2\nlibrary(fontawesome)          # Icons display in ggplot2\nlibrary(ggtext)               # Markdown text support\nlibrary(showtext)             # Display fonts in ggplot2\nlibrary(colorspace)           # To lighten and darken colours\nlibrary(patchwork)            # Combining plots\n\nsearch1 &lt;- owidR::owid_search(\"fertility\")\n\ndf1 &lt;- owid(\"children-per-woman-un\")\n\npopdf &lt;- owid(\"population-with-un-projections\")\n\n\nVisualization Parameters\n\n\nCode\n# Font for titles\nfont_add_google(\"Chakra Petch\",\n  family = \"title_font\"\n) \n\n# Font for the caption\nfont_add_google(\"Saira Semi Condensed\",\n  family = \"caption_font\"\n) \n\n# Font for plot text\nfont_add_google(\"Changa\",\n  family = \"body_font\"\n) \n\nshowtext_auto()\n\n# Colour Palette\nmypal &lt;- rev(paletteer::paletteer_d(\"LaCroixColoR::Lime\")[c(1,2,4:6)])\n\n# Background Colour\nbg_col &lt;- \"grey98\"\ntext_col &lt;- \"grey10\"\ntext_hil &lt;- \"grey25\"\n\n# Base Text Size\nbts &lt;- 80\n\nplot_title &lt;- \"Declining Global Fertility Rates (1950-2020)\"\n\nplot_subtitle &lt;- \"The fertility rate, representing the average number of live births per woman, has notably declined from 1950 to 2020, driven largely by reductions in middle-income countries such as India and China. This graphic highlights this global trend, while also showing that the poorest and war-torn nations have experienced minimal decline in fertility rates. Nearly half of the world's population now has fertility rates below the replacement level.\"\n\ndata_annotation &lt;- \"About the Data: This data on fertility rates, sourced from the United Nations' World Population Prospects (2022) and processed by Our World in Data, spans from 1950 to 2021. It reflects the average number of live births per woman, with age-specific rates, providing insights into global fertility trends across decades.\"\n\n# Caption stuff for the plot\nsysfonts::font_add(\n  family = \"Font Awesome 6 Brands\",\n  regular = here::here(\"docs\", \"Font Awesome 6 Brands-Regular-400.otf\")\n)\ngithub &lt;- \"&#xf09b\"\ngithub_username &lt;- \"aditya-dahiya\"\nxtwitter &lt;- \"&#xe61b\"\nxtwitter_username &lt;- \"@adityadahiyaias\"\nsocial_caption_1 &lt;- glue::glue(\"&lt;span style='font-family:\\\"Font Awesome 6 Brands\\\";'&gt;{github};&lt;/span&gt; &lt;span style='color: {text_hil}'&gt;{github_username}  &lt;/span&gt;\")\nsocial_caption_2 &lt;- glue::glue(\"&lt;span style='font-family:\\\"Font Awesome 6 Brands\\\";'&gt;{xtwitter};&lt;/span&gt; &lt;span style='color: {text_hil}'&gt;{xtwitter_username}&lt;/span&gt;\")\n\nplot_caption &lt;- paste0(\n  \"**Data:** United Nations & Our World in Data  |  \",\n  \"**Code:** \", \n  social_caption_1, \n  \" |  **Graphics:** \", \n  social_caption_2\n  )\nrm(github, github_username, xtwitter, \n   xtwitter_username, social_caption_1, social_caption_2)\n\n\nData Wrangling\n\n\nCode\n# A tibble for the fertility levels in each decade\ndf2 &lt;- df1 |&gt; \n  as_tibble() |&gt; \n  janitor::clean_names() |&gt; \n  rename(fertility = fertility_rate_sex_all_age_all_variant_estimates) |&gt; \n  filter(!is.na(code)) |&gt; \n  filter(entity != \"World\")\n\n\n# A tibble of populations for each coutnry in each decade\npopdf1 &lt;- popdf |&gt; \n  as_tibble() |&gt; \n  janitor::clean_names() |&gt; \n  filter(!is.na(code)) |&gt; \n  filter(entity != \"World\") |&gt; \n  mutate(\n    population = ifelse(\n      is.na(population_sex_all_age_all_variant_estimates),\n      population_sex_all_age_all_variant_medium,\n      population_sex_all_age_all_variant_estimates\n    )\n  ) |&gt; \n  select(-c(population_sex_all_age_all_variant_estimates,\n            population_sex_all_age_all_variant_medium))\n\n# Creating a separate data frame for each decade by a common function so \n# that we can create descending order of fertility for beautiful plotting.\n# Creating a factor levels of Countries sorted by fertility levels\n# in descending order of fertility levels in each decade.\n\nmake_decade_df &lt;- function(years_to_select, to_label){\n\n    temp_df_fertility &lt;- df2 |&gt; \n      filter(year %in% years_to_select) |&gt; \n      group_by(entity, code) |&gt; \n      summarize(fertility = mean(fertility, na.rm = T)) |&gt; \n      arrange(desc(fertility)) |&gt; \n      ungroup()\n    \n    temp_df_pop &lt;- popdf1 |&gt; \n      filter(year %in% years_to_select) |&gt; \n      group_by(entity, code) |&gt; \n      summarise(population = mean(population, na.rm = TRUE)) |&gt; \n      ungroup()\n      \n    levels_con &lt;- temp_df_fertility |&gt; \n      arrange(fertility) |&gt; \n      pull(entity)\n    \n    # labels_con &lt;- temp_df_pop |&gt; \n    #   ungroup() |&gt; \n    #   slice_max(order_by = population, n = to_label) |&gt; \n    #   pull(entity)\n    \n    temp_df_fertility |&gt; \n      left_join(temp_df_pop) |&gt; \n      arrange(desc(fertility)) |&gt; \n      # mutate(entity = fct(entity, levels = levels_con)) |&gt; \n      mutate(population = replace_na(population, 0)) |&gt; \n      mutate(cum_population = cumsum(population)) |&gt; \n      mutate(cum_pop_perc = cum_population / max(cum_population)) |&gt;\n      arrange(fertility) |&gt; \n      mutate(\n        label_entity = if_else(\n          entity %in% to_label,\n          paste0(entity, \" (\", round(fertility, 1), \")\"),\n          NA\n        )\n      )\n      \n\n}\n\ndf1950s &lt;- make_decade_df(\n  1950:1959, \n  c(\"India\", \"China\", \"Rwanda\", \"Philippines\", \"Thailand\", \"Brazil\", \"United States\",\n    \"Norway\")\n  )\ndf1970s &lt;- make_decade_df(\n  1970:1979, \n  c(\"India\", \"China\")\n  )\ndf1990s &lt;- make_decade_df(\n  1990:1999, \n  c(\"China\", \"India\")\n  )\ndf2010s &lt;- make_decade_df(\n  2010:2019, \n  c(\"Saudi Arabia\", \"India\", \"China\")\n  )\n\n\nglobal_mean &lt;- function(decadedf) {\n  decadedf |&gt; \n    summarise(global = weighted.mean(x = fertility, w = population)) |&gt; \n    pull(global) |&gt; \n    round(2)\n}\n\n\nVisualization\n\n\nCode\ntext_annotate &lt;- function(label_val, y_val, temp_col, vjust = 0){\n  annotate(\n    geom = \"text\",\n    x = -0.01,\n    y = y_val,\n    hjust = 1,\n    vjust = vjust,\n    label = label_val,\n    lineheight = 0.25,\n    colour = temp_col,\n    family = \"caption_font\",\n    size = bts / 3.5\n  )\n}\n  \n  \ng &lt;- ggplot(\n    mapping = aes(\n      x = cum_pop_perc,\n      y = fertility,\n      label = label_entity\n    )\n  ) +\n  \n  # Annotations\n  geom_hline(\n    yintercept = 2.1,\n    colour = text_col,\n    linetype = 2,\n    linewidth = 0.4,\n    alpha = 0.75\n  ) +\n  text_annotate(\n    paste0(\"(Decade: 1950-1959)\\nGlobal Average: \", global_mean(df1950s)), \n    global_mean(df1950s), mypal[1]) +\n  text_annotate(\n    paste0(\"(Decade: 1970-1979)\\nGlobal Average: \", global_mean(df1970s)), \n    global_mean(df1970s), mypal[2]) +\n  text_annotate(\n    paste0(\"(Decade: 1990-1999)\\nGlobal Average: \", global_mean(df1990s)), \n    global_mean(df1990s), mypal[3]) +\n  text_annotate(\n    paste0(\"(Decade: 2010-2019)\\nGlobal Average: \", global_mean(df2010s)), \n    global_mean(df2010s), mypal[4]) +\n  text_annotate(\"Global Replacement\\nFertility Level: 2.10\\n(At this level, the\\npopulation stays\\nconstant)\", 2.3, text_col, vjust = 1) +\n  \n  # Decade 1950s\n  geom_line(\n    data = df1950s,\n    colour = mypal[1],\n    linewidth = 0.75\n  ) +\n  geom_text(\n    data = df1950s,\n    hjust = 0,\n    nudge_y = 0.2,\n    colour = mypal[1],\n    family = \"caption_font\",\n    size = bts / 3\n  ) +\n  geom_point(\n    data = df1950s,\n    colour = mypal[1],\n    size = 2,\n    pch = 3\n  ) +\n  \n  # Decade 1970s\n  geom_line(\n    data = df1970s,\n    colour = mypal[2],\n    linewidth = 0.75\n  ) +\n  geom_text(\n    data = df1970s,\n    hjust = 0.5,\n    nudge_y = 0.2,\n    colour = mypal[2],\n    family = \"caption_font\",\n    size = bts / 3\n  ) +\n  geom_point(\n    data = df1970s,\n    colour = mypal[2],\n    size = 2,\n    pch = 3\n  ) +\n  \n  # Decade 1990s\n  geom_line(\n    data = df1990s,\n    colour = mypal[3],\n    linewidth = 0.75\n  ) +\n  geom_text(\n    data = df1990s,\n    hjust = 1,\n    nudge_y = 0.2,\n    nudge_x = -0.075,\n    colour = mypal[3],\n    family = \"caption_font\",\n    size = bts / 3\n  ) +\n  geom_point(\n    data = df1990s,\n    colour = mypal[3],\n    size = 2,\n    pch = 3\n  ) +\n  \n  # Decade 2010s\n  geom_line(\n    data = df2010s,\n    colour = mypal[4],\n    linewidth = 0.75\n  ) +\n  geom_text(\n    data = df2010s,\n    hjust = 1,\n    vjust = 1,\n    nudge_x = -0.02,\n    nudge_y = - 0.1,\n    colour = mypal[4],\n    family = \"caption_font\",\n    size = bts / 3\n  ) +\n  geom_point(\n    data = df2010s,\n    colour = mypal[4],\n    size = 2,\n    pch = 3\n  ) +\n  \n  # Scales and Coordinates\n  scale_x_continuous(\n    labels = label_percent(),\n    expand = expansion(0)\n  ) +\n  scale_y_continuous(\n    expand = expansion(0),\n    position = \"right\",\n    limits = c(0.5, 8.4),\n    breaks = 1:8,\n    labels = 1:8\n  ) +\n  coord_cartesian(\n    xlim = c(0, 1),\n    clip = \"off\"\n  ) +\n  labs(\n    title = plot_title,\n    subtitle = str_wrap(plot_subtitle, 125),\n    caption = plot_caption,\n    x = \"Share of the total Global Population\",\n    y = \"Fertility Rate (average number of babies per woman)\"\n  ) +\n  theme_minimal(\n    base_family = \"body_font\",\n    base_size = bts\n  ) +\n  theme(\n    panel.grid.major = element_line(\n      linetype = 3,\n      linewidth = 0.25,\n      colour = \"grey70\"\n    ),\n    panel.grid.minor = element_line(\n      linetype = 3,\n      linewidth = 0.25,\n      colour = \"grey70\"\n    ),\n    axis.line.y = element_line(\n      linetype = 1,\n      linewidth = 0.6,\n      colour = text_col,\n      arrow = arrow(length = unit(5, \"mm\"))\n    ),\n    axis.ticks.length = unit(0, \"mm\"),\n    axis.line.x = element_line(\n      linetype = 1,\n      linewidth = 0.6,\n      colour = text_col,\n      arrow = arrow(\n        angle = 90,\n        ends = \"both\",\n        length = unit(7, \"mm\")\n      )\n    ),\n    plot.margin = margin(10,10,10,80, \"mm\"),\n    plot.title = element_text(\n      colour = text_hil,\n      size = 2.7 * bts,\n      family = \"title_font\",\n      margin = margin(10,0,0,0, \"mm\")\n    ),\n    plot.subtitle = element_text(\n      colour = text_hil,\n      size = bts * 0.9, \n      family = \"title_font\",\n      margin = margin(5,0,5,0, \"mm\"),\n      lineheight = 0.3\n    ),\n    plot.caption = element_textbox(\n      hjust = 0.5,\n      family = \"caption_font\",\n      colour = text_hil\n    ),\n    axis.title = element_text(\n      colour = text_col,\n      margin = margin(0,0,0,0, \"mm\")\n    ),\n    plot.title.position = \"plot\"\n  )\n\n\nAdding insets and annotations using (Pedersen 2024)\n\n\nCode\n# QR Code for the plot\nurl_graphics &lt;- paste0(\n  \"https://aditya-dahiya.github.io/projects_presentations/projects/\",\n  # The file name of the current .qmd file\n  \"owid_fertility\",\n  \".qmd\"\n)\n# remotes::install_github('coolbutuseless/ggqr')\n# library(ggqr)\nplot_qr &lt;- ggplot(\n  data = NULL, \n  aes(x = 0, y = 0, label = url_graphics)\n  ) + \n  ggqr::geom_qr(\n    colour = text_hil, \n    fill = bg_col,\n    size = 2.2\n    ) +\n  # labs(caption = \"Scan for the Interactive Version\") +\n  coord_fixed() +\n  theme_void() +\n  theme(plot.background = element_rect(\n    fill = NA, \n    colour = NA\n    ),\n    plot.caption = element_text(\n      hjust = 0.5,\n      margin = margin(0,0,0,0, \"mm\"),\n      family = \"caption_font\",\n      size = bts/1.8\n    )\n  )\n\nplot_data &lt;- ggplot() +\n  annotate(\n    geom = \"text\",\n    x = 0, y = 0,\n    label = str_wrap(data_annotation, 30),\n    family = \"caption_font\",\n    colour = text_hil,\n    lineheight = 0.3, \n    size = bts / 6,\n    hjust = 0\n  ) +\n  theme_void()\n\ng_full &lt;- g +\n  inset_element(\n    p = plot_data,\n    left = -0.07, right = 0.12,\n    top = 0.8, bottom = 0.6,\n    align_to = \"full\",\n    clip = FALSE\n  ) +\n  inset_element(\n    p = plot_qr,\n    left = 0.025, right = 0.12,\n    top = 0.98, bottom = 0.77,\n    align_to = \"full\",\n    clip = FALSE\n  ) +\n  plot_annotation(\n    theme = theme(\n      plot.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      ),\n      panel.background = element_rect(\n        fill = \"transparent\", colour = \"transparent\"\n      )\n    )\n  )\n\n\nSave the graphic and a thumbnail\n\n\nCode\nggsave(\n  filename = here::here(\"data_vizs\", \"a4_owid_fertility.png\"),\n  plot = g_full,\n  width = 297 * 2,\n  height = 210 * 2,\n  units = \"mm\",\n  bg = bg_col\n)\n\nlibrary(magick)\n# Saving a thumbnail for the webpage\nimage_read(here::here(\"data_vizs\", \n                      \"a4_owid_fertility.png\")) |&gt; \n  image_resize(geometry = \"400\") |&gt; \n  image_write(here::here(\"data_vizs\", \"thumbnails\", \n                         \"owid_fertility.png\"))\n\n\n\n\n\n\n\nReferences\n\nPedersen, Thomas Lin. 2024. “Patchwork: The Composer of Plots.” https://CRAN.R-project.org/package=patchwork."
  }
]